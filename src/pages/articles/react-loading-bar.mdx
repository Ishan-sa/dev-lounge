import Layout from "@/components/MDXLayout";
import Link from "next/link";

<div className="flex flex-col w-full m-auto gap-2">
<Centerdiv className="flex text-center mt-8 font-bold text-3xl">
# How to add the top loading bar in a Next.js app.
</Centerdiv>
Next.js is a popular framework for building React applications with server-side rendering, static site generation, and other powerful features. One key element that can enhance the user experience of your Next.js app is a top loading bar, which shows the progress of page loading and provides visual feedback to the user. In this blog post, I will walk you through the process of adding a top loading bar to your Next.js app. I'll cover the necessary code and dependencies, and provide step-by-step instructions to help you implement this feature in your own project. By the end of this post, you'll have a polished and professional-looking app with a smooth and responsive user interface. Let's get started!

### Let's start by creating a Next.js app

```jsx
yarn create next-app myloadingapp
cd myloadingapp
```

Once everything is setted up, you can open it in your favorite code editor, (I use VS Code), you can use whatever you feel comfortable with.

### Dependencies

Let's install the `react-top-loading-bar` package now which will allow us to easily integrate the loader.

```jsx
yarn add react-top-loading-bar
```

### Make some pages

Next, we will be making some sample pages so that we have something to route in between to and check the loading bar.

Under your pages directory, we will create 2 more pages by the name of-

1. contact.js
2. about.js

```jsx
// pages/contact.js
import { useRouter } from "next/router";
import Link from "next/link";

export default function contact() {
  const router = useRouter();
  return (
    <>
      <h1>contact</h1>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
      <Link href="/">Back</Link>
    </>
  );
}
```

```jsx
// pages/about.js
import { useRouter } from "next/router";
import Link from "next/link";

export default function about() {
  const router = useRouter();
  return (
    <>
      <h1>About</h1>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p>
      <Link href="/">Back</Link>
    </>
  );
}
```

### Routing

For the routing, we will be using `useRouter()` that comes from `next/router`. We will import that on our `index.js` page.

```jsx
import { useRouter } from "next/router";
```

and we will initialize it with

```jsx
const router = useRouter();
```

We will also add some html for the links. At the end your pages/index.js should look like this

```jsx
// pages/index.js
import Head from "next/head";

import { useRouter } from "next/router";

export default function Home() {
  const router = useRouter();

  const links = [
    {
      id: 1,
      text: "Home",
      url: "/",
    },
    {
      id: 2,
      text: "About",
      url: "/about",
    },
    {
      id: 3,
      text: "Contact",
      url: "/contact",
    },
  ];

  return (
    <>
      <Head>
        <title>Loading Tutorial</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        <nav>
          <ul>
            {links.map((link) => (
              <li key={link.id} onClick={() => router.push(link.url)}>
                {link.text}
              </li>
            ))}
          </ul>
        </nav>
      </main>
    </>
  );
}
```

Once everything is setup, now we will start implementing the loading bar. Now, in our `_app.js` file, we will do all the loading bar-stuff.

Let's start by importing some stuff.

```jsx
import { useState, useEffect } from "react";
import LoadingBar from "react-top-loading-bar";
import { useRouter } from "next/router";
```

Now, we need a state to check and manage the loading bar state and if the page is being routed or not-
so, let's have a progress state and keep it `0` by default-

```jsx
const [progress, setProgress] = useState(0);
```

Now, in the return statement, let's put in the `LoadingBar` component and attach the `progress` state to it-

```jsx
export default function App({ Component, pageProps }) {
  return (
    <>
      <Component {...pageProps} />
      <LoadingBar
        color={"#4287f5"}
        progress={progress}
        shadow={true}
        height={3}
      />
    </>
  );
}
```

Now, let's write the function to handle the loading bar animation, all of this will be done in a `useEffect` because we want the function to be callled everytime the page changes.

```jsx
useEffect(() => {
  const handleStart = () => {
    setProgress(0);
  };
  const handleComplete = () => {
    setProgress(100);
  };
  router.events.on("routeChangeStart", handleStart);
  router.events.on("routeChangeComplete", handleComplete);
  router.events.on("routeChangeError", handleComplete);
  return () => {
    router.events.off("routeChangeStart", handleStart);
    router.events.off("routeChangeComplete", handleComplete);
    router.events.off("routeChangeError", handleComplete);
  };
}, []);
```

The `useEffect` hook is used to set up event listeners for the `routeChangeStart`, `routeChangeComplete`, and `routeChangeError` events that are emitted by the router when a new page is being loaded. These events can be used to track the progress of the page loading process and update the loading bar accordingly.

The `handleStart` function is called when the `routeChangeStart` event is emitted, and it sets the progress state to `0`. This indicates that the loading bar is at the beginning of the progress bar.

The `handleComplete` function is called when the `routeChangeComplete` or `routeChangeError` event is emitted, and it sets the progress state to `100`. This indicates that the loading bar has completed and the page is fully loaded.

The `router.events.on()` method is used to register the event listeners for the router events. The `router.events.off()` method is used to unregister the event listeners when the component is unmounted.

Finally, the return statement in the `useEffect` hook is used to clean up the event listeners when the component is unmounted.

So, finally, your `_app.js` should look like this-

```jsx
import "@/styles/globals.css";
import { useState, useEffect } from "react";
import LoadingBar from "react-top-loading-bar";
import { useRouter } from "next/router";

export default function App({ Component, pageProps }) {
  const router = useRouter();
  const [progress, setProgress] = useState(0);
  useEffect(() => {
    const handleStart = () => {
      setProgress(0);
    };
    const handleComplete = () => {
      setProgress(100);
    };
    router.events.on("routeChangeStart", handleStart);
    router.events.on("routeChangeComplete", handleComplete);
    router.events.on("routeChangeError", handleComplete);
    return () => {
      router.events.off("routeChangeStart", handleStart);
      router.events.off("routeChangeComplete", handleComplete);
      router.events.off("routeChangeError", handleComplete);
    };
  }, []);
  return (
    <div>
      <Component {...pageProps} />
      <LoadingBar
        color={"#4287f5"}
        progress={progress}
        shadow={true}
        height={3}
      />
    </>
  );
}
```

We are almost done! Now, if you run your application and navigate through the pages, you should see the loading bar in action.

If you want to customize the appearance of the loading bar, you can modify the props passed to the LoadingBar component. Here are some of the available props:

- `color`: the color of the loading bar (default: #000000)
- `progress`: the progress of the loading bar (default: 0)
- `shadow`: whether to show a shadow under the loading bar (default: true)
- `height`: the height of the loading bar (default: 3)

You can find more information about these props and their values in the react-top-loading-bar documentation.

<Link
  href="https://github.com/klendi/react-top-loading-bar"
  target="_blank"
>
<p className="text-blue-700">
https://github.com/klendi/react-top-loading-bar 
</p>

</Link>

We made the `LoadingBar` component in `_app.js` because `_app.js` is a special Next.js file that acts as a wrapper for all pages. Any code written in `_app.js` will be shared by all pages, making it an ideal location for code that needs to be executed on every page.

By placing the `LoadingBar` component in `_app.js`, you are ensuring that it is displayed on every page of your application while the page is loading. This can provide a better user experience, as it gives the user an indication that something is happening and the page is not frozen.

Additionally, because the `LoadingBar` component is global, it can access application-wide state or data, making it easier to manage loading state across all pages.

In conclusion, adding a top loading bar to your Next.js app is a simple and effective way to improve the user experience and make your app feel more polished and professional. With the help of the react-top-loading-bar package and some basic Next.js knowledge, you can easily implement this feature in your own project.

</div>
export default ({ children }) => <Layout>{children}</Layout>;
